# Spreasheet

## <mark style="color:red;">I have to corrected the calculation of VAT</mark>

## <mark style="color:red;">and separate B to B and B to C</mark>

## Link to the [spreadsheet](https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=1935476460)

## Description



<table><thead><tr><th width="113">US (link to Github)</th><th>Descpription</th></tr></thead><tbody><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/32592">MOCCT-001</a></td><td>For one article, Quantity 1, Without Ecotax, Price without decimal point, without reduction, fixed VAT, no shipping</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/32274">MOCCT-002</a></td><td>For one article, Quantity <strong>parametrable</strong>, Without Ecotax, Price without decimal point, without reduction, fixed VAT, no shipping</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33684">MOCCT-003</a></td><td>For one article, Quantity parametrable, Without Ecotax, Price without decimal point, without reduction, VAT <strong>parametrable</strong>, no shipping</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/32602">MOCCT_004</a></td><td>For <strong>several</strong> items, Quantity parametrable, Without Ecotax, Price without decimal point, without reduction, VAT parametrable, no shipping</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33691">MOCCT_005</a></td><td>For <strong>several</strong> items, Quantity parametrable, Without Ecotax, Price without decimal point, without reduction, VAT parametrable, <strong>shipping including</strong> - Total Tax excluded, Tax included</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33773">MOCCT_006</a></td><td>[US-Pricing][MOC][Without rounding] : MOCCT- 006 : Cart rules amount Tax excluded without conditions - Display excluded</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33831">MOCCT_007</a></td><td>[US-Pricing][MOC][Without rounding] : MOCCT- 007 : Cart rules amount Tax excluded without conditions - Display included</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33967">MOCCT_006bis</a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 006bis : Cart rules amount Tax included without conditions - Display excluded</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33966"><mark style="color:blue;">MOCCT_007bis</mark></a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 007-bis : Cart rules amount Tax included without conditions - Display included</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33695">MOCCT_008</a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 008 : Cart rules - Code</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33919">MOCCT_009</a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 009 : Cart rules with conditions - Status</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33693">MOCCT_010</a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 010 : Cart rules percentage excluded without condition</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/33974">MOCCT_011</a></td><td>[Lot1][US-Pricing][MOC][Without rounding] : MOCCT- 010 : Cart rules with conditions - Priority behavior</td></tr><tr><td><a href="https://github.com/PrestaShop/PrestaShop/issues/32287">MOCCT_005.1</a></td><td><mark style="color:orange;">[Lot1]:[US-Pricing][MOC][Without rounding] : MOCCT - 005.1 : Taking into account specific price on Price</mark></td></tr></tbody></table>

### Steps of the price calculation

Level 1 is the list of one or several products or value shared by all productd

Level 2 is for each product

The following calculation are this one used in the [sheet](https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055). The key between this specification and the sheet

&#x20;is the id Step\_XX\_\[..]\_XX

#### <mark style="color:blue;">1 - Standard Price and impact price</mark>

<figure><img src="../../../.gitbook/assets/image (172).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow Pricing - Step Standard Price + Impact Price</a></p></figcaption></figure>

<table data-full-width="false"><thead><tr><th width="94">Level</th><th>Formula</th></tr></thead><tbody><tr><td>2</td><td><h4>Step_SP_by_item</h4><p>Description: Retrieve the standard price for each product (SP) </p><p>Formula: NA</p><p>US: MOCCT-001, MOCCT_004</p></td></tr><tr><td>2</td><td><h4>Step_IP_by_item</h4><p>Description: Retrieve the impact Price (IP) for each product</p><p>Formula: NA</p><p>US: MOCCT-001, MOCCT_004</p></td></tr><tr><td>2</td><td><h4>Step_CP_by_item</h4><p>Description: Calculation of the price of the combination HT (CP) for each product</p><p>Formula : CP_by_item = SP_by_item + IP_by_item</p><p>US: MOCCT-001, MOCCT_004</p></td></tr><tr><td>2</td><td><h4><del>Step_CP_Q_by_item</del></h4><p><del>Description: Calculation of the price total (Tax excl) taking into account quantity for each</del> <del>product</del></p><p><del>Formula : CP_Q_by_item = Price_AfterDiscountCatalog_by_item * Quantity of the item</del></p><p><del>US : MOCCT-001,</del> <del>MOCCT-002, MOCCT_004, MOCCT-006</del></p></td></tr></tbody></table>

#### 2 - Discount Specific price

<figure><img src="../../../.gitbook/assets/image (171).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow Pricing - Discount Specific Price</a></p></figcaption></figure>

<table><thead><tr><th width="91">Level</th><th>Formula</th></tr></thead><tbody><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Specific_price_Retail_price_tax_excluded</strong></mark></p><p><mark style="color:orange;"><strong>Description :</strong> Replace the default price. Tis new price is tax excluded</mark></p><p><mark style="color:orange;"><strong>Formula :</strong></mark> </p><p><mark style="color:orange;">In the BO if</mark> <mark style="color:orange;">Set specific price is true retrieve the value in the field</mark></p><p><mark style="color:orange;">Retail price (tax excl.) to set Specific_price_Retail_price_tax_excluded</mark></p><p><mark style="color:orange;"><strong>US</strong> : MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Unit_price_tax_excluded_after_Specific_price_discount_tax_excluded</strong></mark> </p><p><mark style="color:orange;"><strong>Description:</strong> Deduct the amount tax excluded from the initial price which could be the default price or the Unit_price_tax_excluded_after_Specific_price_amount_tax_excluded if it exists.</mark></p><p><mark style="color:orange;"><strong>Formula</strong> :</mark> </p><p><mark style="color:orange;">if Specific_price_amount_tax_excluded is defined and the the discount of the specific price defined in the BO is excluded</mark></p><p><mark style="color:orange;">Unit_price_tax_excluded_after_Specific_price_amount_tax_excluded = Specific_price_Retail_price_tax_excluded - the discount of the specific price defined in the BO</mark></p><p><mark style="color:orange;">else if Specific_price_amount_tax_excluded is NOT defined and the the discount of the specific price defined in the BO is excluded</mark></p><p><mark style="color:orange;">Unit_price_tax_excluded_after_Specific_price_amount_tax_excluded =</mark></p><p> <mark style="color:orange;">CP_By_item - the discount of the specific price defined in the BO</mark></p><p><mark style="color:orange;">else skip this step</mark></p><p><mark style="color:orange;"><strong>US</strong> : MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Unit_price_after_Retail_or_default_price_tax_included</strong></mark> </p><p><mark style="color:orange;"><strong>Description : Retrieve</strong> Specific_price_Retail_price_tax_excluded if exist or the default price and add the taxes to get the unit price tax included.</mark> </p><p><mark style="color:orange;"><strong>Formula :</strong></mark>  </p><p><mark style="color:orange;">if Specific_price_amount_tax_excluded is defined</mark></p><p><mark style="color:orange;">Unit_price_after_Retail_or_default_price_tax_included = Specific_price_amount_tax_excluded * (1+ (Taxes of the item/100))</mark></p><p><mark style="color:orange;">else if Specific_price_amount_tax_excluded is NOT defined</mark> </p><p><mark style="color:orange;">Unit_price_after_Retail_or_default_price_tax_included = CP_By_item * (1+ (Taxes of the item/100))</mark></p><p><mark style="color:orange;"><strong>US :</strong> MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Unit_price_tax_included_after_Specific_price_discount_tax_included</strong></mark></p><p><mark style="color:orange;"><strong>Description:</strong> Deduct the amount tax included from Specific_price_Retail_price_tax_excluded</mark> </p><p><mark style="color:orange;"><strong>Formula</strong> :</mark> </p><p><mark style="color:orange;">If the the discount of the specific price defined in the BO is included</mark></p><p><mark style="color:orange;">Unit_price_tax_included_after_Specific_price_discount_tax_included=</mark> </p><p><mark style="color:orange;">Unit_price_after_Retail_or_default_price_tax_included - the discount of the specific price defined in the BO</mark></p><p><mark style="color:orange;"><strong>US :</strong> MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Unit_price_tax_excluded_after_Specific_price_discount_tax_included</strong></mark></p><p><mark style="color:orange;"><strong>Description:</strong> Retrieve the price taxes excluded in case of specific price tax included</mark></p><p><mark style="color:orange;"><strong>Formula:</strong></mark></p><p><mark style="color:orange;">If the discount of the specific price defined in the BO is included</mark></p><p><mark style="color:orange;">Unit_price_tax_excluded_after_Specific_price_discount_tax_included =Unit_price_tax_included_after_Specific_price_discount_tax_included/ (1+ (Taxes of the item/100))</mark> </p><p><mark style="color:orange;"><strong>US</strong> : MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Unit_price_tax_excluded_depending_on_specific_price_or_not</strong></mark></p><p><mark style="color:orange;"><strong>Description:</strong> At this step depending on if there is no specific price or specific price with discount tax excluded or tax included the current variable will be set with the adapted price tax excluded.</mark></p><p><mark style="color:orange;"><strong>Formula:</strong></mark> </p><p><mark style="color:orange;">If no specific price</mark> <mark style="color:orange;">Unit_price_tax_excluded_depending_on_specific_price_or_not = CP_by_Item</mark> </p><p><mark style="color:orange;">else if In the BO if</mark> <mark style="color:orange;">Set specific price is true but no specific price ase discount excluded or included Unit_price_tax_excluded_depending_on_specific_price_or_not = Specific_price_Retail_price_tax_excluded</mark> </p><p><mark style="color:orange;">else if  In the BO if</mark> <mark style="color:orange;">Set specific price is true and there is a discount tax excluded</mark></p><p><mark style="color:orange;">Unit_price_tax_excluded_depending_on_specific_price_or_not = Unit_price_tax_excluded_after_Specific_price_discount_tax_excluded</mark></p><p><mark style="color:orange;">else if  In the BO if</mark> <mark style="color:orange;">Set specific price is true and there is a discount tax included</mark></p><p> <mark style="color:orange;">Unit_price_tax_excluded_depending_on_specific_price_or_not =  Unit_price_tax_excluded_after_Specific_price_discount_tax_included</mark> </p><p><mark style="color:orange;"><strong>US</strong> : MOCCT-005.1</mark></p></td></tr></tbody></table>

#### 3 - Discount Catalog Price Rules

<figure><img src="../../../.gitbook/assets/image (169).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow of pricing - Step Discount Catalog Price Rules</a></p></figcaption></figure>

<table><thead><tr><th width="107">Level</th><th>Formula</th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table>

#### 4 - Discount - Customer Group

<figure><img src="../../../.gitbook/assets/image (170).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Worklfow of pricing - Step Discount Customer Group</a></p></figcaption></figure>

|   |   |   |
| - | - | - |
|   |   |   |
|   |   |   |
|   |   |   |

<table><thead><tr><th width="91">Level</th><th>Formula</th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Price_AfterDiscountCatalog_by_item</strong></mark></p><p><mark style="color:orange;">Description: Retrieve the price HT for each product after Specific Price and/or Catalog Price Rules and/or Group Discount Price_AfterDiscountCatalog_by_item</mark></p><p><mark style="color:orange;">Formula : NA</mark></p><p><mark style="color:orange;">US: MOCCT-005.1</mark></p></td></tr><tr><td>2</td><td><p><mark style="color:orange;"><strong>Step_Calculation_item_tax_included_from_item_tax_excluded</strong></mark></p><p><mark style="color:orange;"><strong>Description :</strong> Calculation of the item price tax included from item taxe excluded <strong>Formula :</strong> Price_AfterDiscountCatalog_by_item * (1+ (Taxes of the item/100))</mark></p></td></tr></tbody></table>



#### 5 - Discount- Cart Rules

<figure><img src="../../../.gitbook/assets/image (173).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow of pricing - Step Discount - Cart rules</a></p></figcaption></figure>

Cart rules percent

<table data-full-width="false"><thead><tr><th width="126">Level</th><th>Formula</th></tr></thead><tbody><tr><td></td><td><p><strong>Step</strong>_<strong>Cart_rules_price_excluded_after discount_percent_excluded</strong></p><p><strong>Description :</strong> Apply the discount taxes excluded on the precedent unit price tax excluded</p><p><strong>Formula</strong> <span data-gb-custom-inline data-tag="emoji" data-code="1f44d">üëç</span></p><p>1) If first cart rule </p><p>Cart_rules_price_excluded_after discount_percent_excluded = Price_AfterDiscountCatalog_by_item -( Percent_of_the_discount_tax_excl/100*Price_AfterDiscountCatalog_by_item )</p><p></p><p>2) if it exist a precedent discount</p><p>Cart_rules_price_excluded_after discount_percent_excluded =</p><p>Price_after_Cart_rules_*_By_Item -( Percent_of_the_discount_tax_excl/100*Price_after_Cart_rules_*_By_Item)</p><p></p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_price_Taxe_included_before_discount</strong></p><p><strong>Description :</strong> Price with TVA on the last price taxe excluded or discount taxe excluded</p><p><strong>Formula :</strong> </p><p>1) If first cart rule </p><p>Cart_rules_price_Taxe_included = Price_AfterDiscountCatalog_by_item * ((1+ (Taxes of the item/100))</p><p></p><p>2) if it exist a precedent discount</p><p>Cart_rules_price_Taxe_included = Price_after_Cart_rules_*_By_Item * ((1+ (Taxes of the item/100))</p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_price_included_after_discount_percent_included</strong></p><p><strong>Description :</strong> New price taxes included after Cart rules discount percent included</p><p><strong>Formula :</strong></p><p>Cart_rules_price_included_after_discount_percent_included = Cart_rules_price_Taxe_included - Percent of the discount/100*Cart_rules_price_Taxe_included_before_discount</p><p></p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_price_tax_included_after_discount_percent included_convert_price_tax excluded</strong></p><p><strong>Description :</strong> Cart rules discount Percent taxes included - price taxe excluded deduct from price tax included</p><p>Formula </p><p>Cart_rules_price_tax_included_after_discount_percent included_convert_price_tax excluded = Cart_rules_price_included_after_discount_percent_included /((1+ (Taxes of the item/100))</p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_price_tax_excluded_after discount_percent_excluded_mult_quantity</strong></p><p><strong>Description :</strong> Sum of Price taxes excluded after discount multiplied by quantity</p><p><strong>Formula :</strong> ‚àë (Cart_rules_price_excluded_after discount_percent_excluded * Quantity of the item)</p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_price_tax_included_after_discount_percent included_mult_quantity</strong></p><p><strong>Description :</strong> Sum of Price taxes included after discount multiplied by quantity</p><p><strong>Formula :</strong> ‚àë (Cart_rules_price_included_after_discount_percent included * Quantity of the item)</p><p><strong>US : MOCCT_010</strong></p></td></tr><tr><td></td><td><p><strong>Step_Price_taxe_excluded_after_Cart_rules</strong> </p><p><strong>Description</strong> : Unit price tax excluded depending on alternative (percent excluded or included) </p><p><strong>Formula</strong> if display excluded retrieve Cart_rules_price_tax_excluded_after discount_percent_excluded else retrieve Cart_rules_price_tax_included_after_discount_percent included_convert_price_tax excluded</p><p><strong>US : MOCCT_010</strong></p></td></tr></tbody></table>

Cart rules amount

<table data-full-width="false"><thead><tr><th width="129">Level</th><th>Formula</th></tr></thead><tbody><tr><td><mark style="color:orange;">2</mark></td><td><p><strong>Step_Cart_rules_amount_excluded_By_Item_step1</strong></p><p>Description: Calculation of the new price of chart after a discount <strong>amount</strong> <strong>Tax excluded</strong></p><p>Step 1 consist to Calculation of the prorata of the discount on each product</p><p>Formula: </p><p>1) If first cart rule </p><p>Cart_rules_amount_excluded_By_Item_step1 = CP_Q_by_item / SUM(CP_Q_by_item )*Amount of the discount</p><p></p><p>2) if it exist a precedent discount</p><p>Cart_rules_amount_excluded_By_Item_step1 =(Precedent Prix reduit * Quantity of the product)/ SUM(Precedent Prix reduit * Quantity of the product)*Amount of the discount.</p><p>US: MOCCT-006</p></td></tr><tr><td><mark style="color:orange;">2</mark></td><td><p><strong>Step_Cart_rules_amount_excluded_By_Item_step2</strong></p><p>Description:Deduct the prorata of cart rules from Price of the product</p><p>Formula:</p><p>Cart_rules_amount_excluded_By_Item_step2=</p><p>(Price_AfterDiscountCatalog_by_item-Cart_rules_amount_excluded_By_Item_step1)/Quantity of the product </p><p>US: MOCCT-006</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_excluded_By_Item_prorata_display_included</strong></p><p></p><p><strong>Description:</strong>Prorata of the discount on each product * quantity</p><p>Cart_rules_amount_excluded_By_Item_prorata_display_included <strong>=</strong> CP_Q_by_item / Sum ( CP_Q_by_item) on each item *(amount of the discount taxes excluded )*((1+ (Taxes of the item/100))</p><p>US : MOCCT_007</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_excluded_By_Item_unit_price_display_included</strong></p><p><strong>Description</strong> : Unit price after application of prorata on the price for display included (B to B)</p><p><strong>Formula</strong> : Cart_rules_amount_excluded_By_Item_step2 *((1+ (Taxes of the item/100))</p><p>US : MOCCT_007</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_excluded_By_Item_prorata_display_included</strong></p><p>Description : For now retrieve Cart_rules_amount_excluded_By_Item_unit_price_display_included</p><p>Formula : </p><p>US : MOCCT-007</p></td></tr><tr><td></td><td><p><strong>Step_Price_after_Cart_rules_amount_By_Item</strong></p><p>Description : Retrieve the price HT after the last discount. </p><p>Formula : Price_after_Cart_rules_amount_By_Item =</p><ul><li>if no discount retrieve Step_Price_AfterDiscountCatalog_by_item</li></ul><ul><li>if the last discount is amount excluded retrieve</li></ul><p>     Cart_rules_amount_excluded_By_Item_step2</p><ul><li>if the last discount is amount included retrieve TBD in another US</li></ul><ul><li>if the last discount is percent excluded retrieve TBD in another US</li></ul><ul><li>if the last discount is amount included retrieve TBD in another US</li></ul><p>US : MOCCT-006</p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_amount_included_By_Item_prorata_display_included</strong></p><p><strong>Description : If the discount is "Amount" "Taxe included" Add taxes to price without taxes</strong></p><p><strong>Formula :</strong> Cart_rules_amount_included_By_Item_prorata_display_included=<strong>Retrieve the last unit price HT *</strong> (1+ (Taxes of the item/100)</p><p>US : MOCCT-006bis</p></td></tr><tr><td></td><td><p><strong>Step_Cart_rules_amount_included_mult_quantity</strong></p><p><strong>Description</strong> : If the discount is "Amount" "Taxe included"  Unit price with taxes multiply by quantity</p><p><strong>Formula</strong> : Cart_rules_amount_included_mult_quantity = Cart_rules_amount_included_By_Item_prorata_display_included * Quantity of the item</p><p>US : MOCCT-006bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_included_By_Item_prorata_discount_display_included</strong></p><p>Description :  If the discount is "Amount" "Taxe included" Prorata of the discount amount on each article</p><p>Formula : Cart_rules_amount_included_By_Item_prorata_discount_display_included = Cart_rules_amount_included_By_Item_prorata_display_included / Sum ( Cart_rules_amount_included_mult_quantity ) on each item *(amount of the discount taxes excluded )</p><p>US : MOCCT-007bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_included_prorata_discount_multiply_by_quantity</strong></p><p>Description :  If the discount is "Amount" "Taxe included"</p><p>Formula : Cart_rules_amount_included_prorata_discount_multiply_by_quantity = Cart_rules_amount_included_By_Item_prorata_discount_display_included * Quantity of the product</p><p>US : MOCCT-007bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_included_price_after_prorata_display_included</strong></p><p>Description :  If the discount is "Amount" "Taxe included"</p><p><strong>Formula :</strong> Cart_rules_amount_included_By_Item_prorata_display_included - Cart_rules_amount_included_By_Item_prorata_discount_display_included</p><p></p><p>US : MOCCT-007bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_amount_taxes_included_convert_HT_mult_by_quantity</strong></p><p>Description :If the discount is "Amount" "Taxe included" conversion HT (each article * quantity)</p><p>Formula : Cart_rules_amount_taxes_included_convert_HT_mult_by_quantity = Cart_rules_amount_included_By_Item_prorata_discount_display_included *  (1+ (Taxes of the item/100) * quantity of the product</p><p>US : MOCCT-007bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_Amount_display_taxes_excluded</strong></p><p>Description: Using for the display of the discount in the chart tax excluded</p><p>Formula: if the discount is "Amount" and "Taxes excluded" retrieve Cart_rules_amount_excluded_By_Item_step1</p><p>else if the discount is "Amount" and "Taxes included" retrieve Cart_rules_amount_taxes_included_convert_HT_mult_by_quantity else 0</p><p>US:MOCCT-006bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Cart_rules_Amount_display_taxes_included</strong></p><p>Description: Using for the display of the discount in the chart tax included</p><p>Formula: if the discount is "Amount" and "Taxes excluded" retrieve Cart_rules_amount_excluded_By_Item_prorata_display_included</p><p>else if the discount is "Amount" and "Taxes included" retrieve Cart_rules_amount_included_prorata_discount_multiply_by_quantity </p><p>else 0</p><p>US:MOCCT-007bis</p></td></tr><tr><td>2</td><td><p><strong>Step_Price_after_Cart_rules_amount_By_Item</strong></p><p>Description : Retrieve the unit price taxes excluded after discount Cart_rules_amount_excluded_By_Item_step2 if amount different of 0 else last unit price without taxes </p><p>Formula : </p><p>if amount excluded retr</p><p>US : MOCCT-006</p></td></tr><tr><td>2</td><td><h4>Step_Taxes_excluded_By_item</h4><p>Description: Calculation of taxes excluded (By_item_Taxes_excluded) for each product</p><p>Formula: </p><p>Taxes_excluded_By_item = Price_after_Cart_rules_amount_By_Item *  Quantity of the product</p><p>US: MOCCT-001, MOCCT_004, MOCCT-006</p></td></tr><tr><td>1</td><td><h4>Step_Taxes_excluded_Total</h4><p>Description: Calculation of total taxes excluded (Total_Taxes_excluded) for all products</p><p>Formula: </p><p>Taxes_excluded_Total = Sum Taxes_excluded_By_item of each product                   </p><p>US: MOCCT_004</p></td></tr></tbody></table>

#### 5 - VAT

<figure><img src="../../../.gitbook/assets/image (165).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow of pricing - Step VAT</a></p></figcaption></figure>

<table data-full-width="false"><thead><tr><th>Level</th><th>Formula</th></tr></thead><tbody><tr><td>2</td><td><h4>Step_RVAT_By_item </h4><p>Description: Recovery of rate of VAT (RVAT) for each product</p><p>Formula:  Retrieve the VAT of the product by (Country, state, zip code)</p><p>US: MOCCT-001<mark style="color:purple;">,</mark>  MOCCT-003, MOCCT_004</p></td></tr><tr><td>2</td><td><h4>Step_AmountTVATaxExcluded_By_Item</h4><p>Description: Calculation of VAT amount on unit price before tax (AmountTVATaxExcluded_By_Item) for each product </p><p>Formula<mark style="color:red;">:</mark> AmountTVATaxExcluded_By_Item = RVAT_By_Item * Total_Taxes_excluded_By_Item</p><p>US: MOCCT_004</p></td></tr><tr><td>1</td><td><h4>Step_AmountTVATaxExcluded_Total</h4><p></p><p>Description: Calculation of VAT amount on unit price before tax (AmountTVATaxExcluded) for all products </p><p>Formula: AmountTVATaxExcluded_Total = Sum (RVAT_By_item * Total_Taxes_excluded_By_Item)</p><p>US: MOCCT_004</p></td></tr></tbody></table>



#### 6 - Retrieve cost of Shipping

<figure><img src="../../../.gitbook/assets/image (166).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflow of pricing - Step Retrieve cost of shipping</a></p></figcaption></figure>

| Level | Formul                                                                                                                                                                          |
| ----- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1     | <p><strong>Step_Shipping_Tax_excluded</strong></p><p>Description: Retrieve the shipping tax excluded (Shipping_tax_excluded)</p><p>Formula: NA         </p><p>US: MOCCT_005</p> |



#### 8 - Display of the chart tax excluded for B to B

<figure><img src="../../../.gitbook/assets/image (167).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Worflow of pricing - Step Display of the chart tax excluded</a></p></figcaption></figure>



<table data-full-width="false"><thead><tr><th>Level</th><th>Formula</th></tr></thead><tbody><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_1_Tax_excluded</strong></p><p><strong>Description:</strong> Using for the display of the discount in the chart tax excluded in case of discount percent tax excluded</p><p><strong>Formula:</strong></p><p>1) If first cart rule </p><p>Discount_Cart_rule_1_Tax_excluded = -1 * (‚àë Price_AfterDiscountCatalog_by_item for each item - ‚àë Cart_rules_price_tax_excluded_after_discount_percent_excluded_mult_quantity for each item)</p><p></p><p>2) if it exist a precedent discount =</p><p> -1 * (‚àë Cart rules price tax excluded after discount_XX * quantity for each item -</p><p>‚àë Cart_rules_price_tax_excluded_after_discount_percent included_mult_quantity)</p><p></p><p><strong>US-MOCCT-010</strong></p></td></tr><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_3_Tax_excluded</strong></p><p>Description :Description: Using for the display of the discount in the chart tax excluded</p><p>Formula : Sum for each item Step_Cart_rules_Amount_display_taxes_excluded</p><p>US : MOCCT_007bis</p></td></tr><tr><td>1</td><td><p><strong>Step_Sum_Cart_rules_discount_Tax_excluded</strong></p><p>Description : Calculation of the total of discount tax excluded</p><p>Formula: Sum of each Step_Discount_Cart_ruleX_Tax_excluded</p><p>US : MOCCT_007bis</p></td></tr><tr><td>1</td><td><p><strong>Step_Taxes_excluded_with_shipping_cost_excluded_total</strong></p><p>Description: Calculation of the total tax excluded adding shipping cost excluding</p><p>Formula: Total_tax_excluded_with_shipping_cost_excluded=Shipping_tax_excluded + Taxes_excluded_Total         </p><p>US: MOCCT_005</p></td></tr><tr><td>1</td><td><h4>Step_Taxes_without_shipping_included_Total</h4><p>Description<mark style="color:purple;">:</mark> Calculation of total taxes included(Total_Taxes_excluded) for all product</p><p>Formula<mark style="color:purple;">:</mark></p><p> Taxes_included_Total =  Taxes_excluded_Total + AmountTVATaxExcluded_Total                    </p><p>US: MOCCT-001, MOCCT_004</p></td></tr></tbody></table>

#### 8 - Display of the chart tax included

<figure><img src="../../../.gitbook/assets/image (168).png" alt=""><figcaption><p><a href="https://docs.google.com/spreadsheets/d/1SKKAMRoQqmfnpv7Hg2fZdsrd1DjfuyYB3u8gmejZ3ZM/edit#gid=538880055">Workflof of pricing - Step display of the chart tax included</a></p></figcaption></figure>

<table data-full-width="false"><thead><tr><th width="113">Level</th><th>Formula</th></tr></thead><tbody><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_1_Tax_excluded</strong></p><p><strong>Description:</strong> Using for the display of the discount in the chart tax excluded in case of discount percent tax excluded</p><p><strong>Formula:</strong></p><p>1) If first cart rule </p><p>Discount_Cart_rule_1_Tax_excluded = -1 * (‚àë Price_AfterDiscountCatalog_by_item for each item - ‚àë Cart_rules_price_tax_excluded_after_discount_percent_excluded_mult_quantity for each item)</p><p></p><p>2) if it exist a precedent discount =</p><p> -1 * (‚àë Cart rules price tax excluded after discount_XX * quantity for each item -</p><p>‚àë Cart_rules_price_tax_excluded_after_discount_percent included_mult_quantity)</p><p></p><p><strong>US-MOCCT-010</strong></p></td></tr><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_3_Tax_excluded</strong></p><p>Description :Description: Using for the display of the discount in the chart tax excluded</p><p>Formula : Sum for each item Step_Cart_rules_Amount_display_taxes_excluded</p><p>US : MOCCT_007bis</p></td></tr><tr><td>1</td><td><p><strong>Step_Sum_Cart_rules_discount_Tax_excluded</strong></p><p>Description : Calculation of the total of discount tax excluded</p><p>Formula: Sum of each Step_Discount_Cart_ruleX_Tax_excluded</p><p>US : MOCCT_007bis</p></td></tr><tr><td>1</td><td><p><strong>Step_Taxes_excluded_with_shipping_cost_excluded_total</strong></p><p>Description: Calculation of the total tax excluded adding shipping cost excluding</p><p>Formula: Total_tax_excluded_with_shipping_cost_excluded=Shipping_tax_excluded + Taxes_excluded_Total         </p><p>US: MOCCT_005</p></td></tr><tr><td>1</td><td><h4>Step_Taxes_without_shipping_included_Total</h4><p>Description<mark style="color:purple;">:</mark> Calculation of total taxes included(Total_Taxes_excluded) for all product</p><p>Formula<mark style="color:purple;">:</mark></p><p> Taxes_included_Total =  Taxes_excluded_Total + AmountTVATaxExcluded_Total                    </p><p>US: MOCCT-001, MOCCT_004</p></td></tr><tr><td>1</td><td><p><strong>Step_Shipping_Tax_included</strong></p><p>Description: Retrieve the shipping tax included ( Shipping_tax_included)</p><p>Formula: NA         </p><p>US: MOCCT_005</p></td></tr><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_1_Tax_included</strong></p><p>Description : Using for the display of the discount in the chart tax included in case of discount percent tax included</p><p><strong>Formula:</strong></p><p>1) If first cart rule </p><p>Discount_Cart_rule_1_Tax_excluded = -1 * (‚àë (Price_AfterDiscountCatalog_by_item  * (1+ (Taxes of the item/100)) for each item)  - ‚àë Cart_rules_price_tax_included_after_discount_percent included_mult_quantityfor each item)</p><p></p><p>2) if it exist a precedent discount =</p><p> -1 * (‚àë Cart rules price tax included after discount_XX * quantity for each item -</p><p>‚àë Cart_rules_price_tax_included_after_discount_percent included_mult_quantity)</p><p></p><p><strong>US-MOCCT-010</strong></p></td></tr><tr><td>1</td><td><p><strong>Step_Discount_Cart_rule_3_Tax_included</strong></p><p>Description : Using for the display of the discount in the chart tax included</p><p>Formula : -1 * Sum for each item Step_Cart_rules_Amount_display_taxes_included</p><p>US : MOCCT_006bis, <strong>US-MOCCT-010</strong></p></td></tr><tr><td>1</td><td><p><strong>Step_Sum_Cart_rules_discount_Tax_included</strong></p><p>Description : Calculation of the total of discount taxes included</p><p>Formula: Sum of each Step_Discount_Cart_ruleX_Tax_included</p><p>US : MOCCT_006</p></td></tr><tr><td>1</td><td><h4>Step_Taxes_included_with_shipping_cost_included_total</h4><p>Description: Calculation of the total tax included adding shipping cost including</p><p>Formula:</p><p>Total_tax_included_with_shipping_cost_included =  Taxes_without_shipping_included_Total + Shipping_tax_included                  </p><p>US: MOCCT-001, MOCCT_004, MOCCT_005</p></td></tr></tbody></table>



#### Rules of calculation for cart rules

During the process of pricing you have to check [Edit or add Cart Rule](../../ux-ui/back-office/sell/catalog/discounts/edit-or-add-cart-rule.md#code) for following rules

MR\_Pricing\_calc\_001 : If field [Code ](../../ux-ui/back-office/sell/catalog/discounts/edit-or-add-cart-rule.md#code)in cart rules is blank, the rule will automatically be applied to benefiting customers. (MOCCT-008)

MR\_Pricing\_calc\_002 : If field Code in cart rules is filled, the discount will be apply only if the code has been added in the chart.(MOCCT-008)

MR\_Pricing\_calc\_003 : [Status](../../ux-ui/back-office/sell/catalog/discounts/edit-or-add-cart-rule.md#status). Apply the cart rules if Status is "Yes".If Status is "No" the cart Rule is not applied (MOCCT-009)

MR\_Pricing\_calc\_004 : [Priority behavior](../../ux-ui/back-office/sell/catalog/discounts/edit-or-add-cart-rule.md#priority-behavior) (MOCCT-011)

~~MR\_Pricing\_calc\_005 :~~ [~~Partial use~~](../../ux-ui/back-office/sell/catalog/discounts/edit-or-add-cart-rule.md#partial-use-switch-toggle-button-behavior) ~~The price of an item after prorata discount for an amount could not be lower than 0.~~

~~Amount of the second voucher :~~

~~If the amount discount is included : sum of product prices taxes included before discount - Sum of products prices taxes included after discount.~~

~~If the amount discount is excluded : sum of product prices taxes excluded before discount - Sum of products prices taxes excluded after discount.~~
